#: kivy 1.10.0
#: import lib lib
#: import main main
#: import playground playground

####################################################################################
## Flash Cards Screen
####################################################################################

<FlashCardDeckRow@BoxLayout>:
    fc_deck_id: ''
    fc_deck_name: ''
    fc_deck_excerpt: ''
    canvas.before:
        Color:
            rgba: 0.5, 0.5, 0.5, 1
        Rectangle:
            size: self.size
            pos: self.pos
    BoxLayout:
        BoxLayout:
            orientation: "vertical"
            Label:
                size_hint_y: 0.3
                text: root.fc_deck_name
            RstDocument:
                text: root.fc_deck_excerpt
        BoxLayout:
            size_hint_x: 0.15
            orientation: "vertical"
            Button:
                text: "Study"
                on_release: lib.Navigation.page_nav(dest='flash_card_deck_study', orig='flash_cards', fc_deck_id=root.fc_deck_id)
            Button:
                size_hint_y: 0.7
                text: "View"
                on_release: lib.Navigation.page_nav(dest='flash_card_deck', orig='flash_cards', fc_deck_id=root.fc_deck_id)
        BoxLayout:
            size_hint_x: None
            width: dp(30)
            Button:
                text: "D\nE\nL"
                on_release: lib.Navigation.confirm_flash_card_deck_delete(root.fc_deck_id)

<FlashCardsScreen>:
    fc_deck_rv: fc_deck_rv
    BoxLayout:
        orientation: "vertical"
        TopMenu:
        BoxLayout:
            RecycleView:
                id: fc_deck_rv
                scroll_type: ['bars', 'content']
                scroll_wheel_distance: dp(114)
                bar_width: dp(10)
                viewclass: 'FlashCardDeckRow'
                RecycleBoxLayout:
                    padding: [dp(10), 0, dp(10), 0]
                    default_size: None, dp(150)
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation: 'vertical'
                    spacing: dp(2)
        BoxLayout:
            size_hint_y: 0.1
            Button:
                text: "Add New Flash Card"
                on_release: lib.Navigation.page_nav(dest='new_flash_card', orig='flash_cards', edit=False)
            Button:
                text: "Add New Deck"
                on_release: lib.Navigation.page_nav(dest='new_flash_card_deck', orig='flash_cards', edit=False)
            Button:
                text: "View All Cards"
                on_release: lib.Navigation.page_nav(dest='all_flash_cards', orig='flash_cards', edit=False)

<FlashCardRow@BoxLayout>:
    fc_id: ''
    fc_title: ''
    fc_decks: ''
    fc_tags: ''
    fc_deck_id: ''
    canvas.before:
        Color:
            rgba: 0.5, 0.5, 0.5, 1
        Rectangle:
            size: self.size
            pos: self.pos
    BoxLayout:
        Label:
            text: root.fc_title
        Label:
            text: root.fc_tags
        Label:
            text: root.fc_decks
        Button:
            size_hint_x: 0.2
            text: "View/Edit"
            on_release: lib.Navigation.page_nav(dest='new_flash_card', orig='flash_card_deck', edit=True, fc_id=root.fc_id)
        Button:
            size_hint_x: 0.1
            text: "D\nE\nL"
            on_release: lib.Navigation.confirm_flash_card_delete(root.fc_id)

<AllFlashCardsScreen>:
    fc_rv: fc_rv
    BoxLayout:
        orientation: "vertical"
        TopMenu:
        BoxLayout:
            RecycleView:
                id: fc_rv
                scroll_type: ['bars', 'content']
                scroll_wheel_distance: dp(114)
                bar_width: dp(10)
                viewclass: 'FlashCardRow'
                RecycleBoxLayout:
                    padding: [dp(10), 0, dp(10), 0]
                    default_size: None, dp(150)
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation: 'vertical'
                    spacing: dp(2)
        BoxLayout:
            size_hint_y: 0.1
            Button:
                text: "Add New Flash Card"
                on_release: lib.Navigation.page_nav(dest='new_flash_card', orig='all_flash_cards', edit=False)
            Button:
                text: "Add New Deck"
                on_release: lib.Navigation.page_nav(dest='new_flash_card_deck', orig='all_flash_cards', edit=False)
            Button:
                text: "View All Decks"
                on_release: lib.Navigation.page_nav(dest='flash_cards', orig='all_flash_cards', edit=False)

<NewFlashCardScreen>:
    title: 'New Flashcard'
    BoxLayout:
        orientation: "vertical"
        padding: 10
        ColorBar:
        BoxLayout:
            size_hint_y: 0.1
            Label:
                size_hint_x: 0.2
                text: "Card Title"
                text_size: self.text_size
                valign: 'middle'
            TextInput:
                id: new_fc_title
                multiline: False
                padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
                text: root.data['fc_title'] if 'fc_title' in root.data else ""
                on_text: root.data['fc_title'] = self.text
        BoxLayout:
            size_hint_y: 0.1
            Label:
                size_hint_x: 0.2
                text: "Card Tag(s)"
                text_size: self.text_size
                valign: 'middle'
            BoxLayout:
                MultiSelectSpinner:
                    id: new_fc_tag
                    text: root.data['fc_tags'] if 'fc_tags' in root.data else "Select tag(s)"
                    values: root.fc_tag_spinner_list
                    on_text: root.data['fc_tags'] = self.text
                Button:
                    size_hint_x: 0.3
                    text: "New Tag"
                    on_release: lib.Navigation.page_nav(dest='new_flash_card_tag', orig='new_flash_card', edit=False)
        BoxLayout:
            size_hint_y: 0.1
            Label:
                size_hint_x: 0.2
                text: "Card Deck(s)"
                text_size: self.text_size
                valign: 'middle'
            BoxLayout:
                MultiSelectSpinner:
                    id: new_fc_deck
                    text: root.data['fc_decks'] if 'fc_decks' in root.data else "Select deck(s)"
                    values: root.fc_deck_spinner_list
                    on_text: root.data['fc_decks'] = self.text
                Button:
                    size_hint_x: 0.3
                    text: "New Deck"
                    on_release: lib.Navigation.page_nav(dest='new_flash_card_deck', orig='new_flash_card', edit=False)
        BoxLayout:
            orientation: "vertical"
            BoxLayout:
                size_hint_y: 0.1
                FloatLayout:
                    Label:
                        pos: self.parent.pos
                        size_hint: None, None
                        size: (self.parent.width, self.parent.height)
                        text: "Card Front"
                    Button:
                        size_hint: None, None
                        width: dp(200)
                        height: self.parent.height
                        pos: self.parent.pos
                        text: "Clear Front Drawings"
                        on_release: fc_front_draw.canvas.clear()
            BoxLayout:
                TextInput:
                    id: new_fc_front
                    multiline: True
                    text: root.data['fc_front_text'] if 'fc_front_text' in root.data else ""
                    on_text: root.data['fc_front_text'] = self.text
                FloatLayout:
                    RstDocument:
                        pos: self.parent.pos
                        text: new_fc_front.text
                        show_errors: True
                        canvas.before:
                            Rectangle:
                                size: self.parent.size
                                pos: self.parent.pos
                                source: root.data['fc_front_image'] if 'fc_front_image' in root.data else ""
                    BoxLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        BoxLayout:
                            id: fc_front_for_saving
                            size_hint: None, None
                            size: self.parent.size
                            DrawSpace:
                                id: fc_front_draw
                                StencilView:
                                    size_hint: None, None
                                    size: self.parent.size
        BoxLayout:
            orientation: "vertical"
            BoxLayout:
                size_hint_y: 0.1
                FloatLayout:
                    Label:
                        pos: self.parent.pos
                        size_hint: None, None
                        size: (self.parent.width, self.parent.height)
                        text: "Card Back"
                    Button:
                        size_hint: None, None
                        width: dp(200)
                        height: self.parent.height
                        pos: self.parent.pos
                        text: "Clear Back Drawings"
                        on_release: fc_back_draw.canvas.clear()
            BoxLayout:
                canvas:
                    Color:
                        rgba: (1, 1, 1, 1)
                    Rectangle:
                        pos: self.parent.pos
                        size: self.parent.size
                TextInput:
                    id: new_fc_back
                    multiline: True
                    text: root.data['fc_back_text'] if 'fc_back_text' in root.data else ""
                    on_text: root.data['fc_back_text'] = self.text
                FloatLayout:
                    RstDocument:
                        pos: self.parent.pos
                        text: new_fc_back.text
                        show_errors: True
                        canvas.before:
                            Rectangle:
                                size: self.parent.size
                                pos: self.parent.pos
                                source: root.data['fc_back_image'] if 'fc_back_image' in root.data else ""
                    BoxLayout:
                        pos: self.parent.pos
                        size: self.parent.size
                        BoxLayout:
                            id: fc_back_for_saving
                            size_hint: None, None
                            size: self.parent.size
                            DrawSpace:
                                id: fc_back_draw
                                StencilView:
                                    size_hint: None, None
                                    size: self.parent.size
                                    canvas:
        BoxLayout:
            size_hint_y: 0.2
            Button:
                text: "Cancel"
                on_release: lib.Navigation.page_nav(dest='flash_cards', orig='new_flash_card', edit=False)
            Button:
                text: "Submit"
                on_release: root.dispatch('on_submit', root.data, fc_front_for_saving, fc_back_for_saving, fc_front_draw)

<NewFlashCardTagScreen>:
    title: "New/Edit Flash Card Tag"
    BoxLayout:
        orientation: "vertical"
        BoxLayout:
            size_hint_y: 0.1
            padding: dp(10)
            orientation: "vertical"
            BoxLayout:
                Label:
                    size_hint_x: 0.3
                    text: "Tag Name"
                TextInput:
                    padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
                    id: new_author_first
                    on_text: root.data['fc_tag_name'] = self.text
        BoxLayout:
            TextInput:
                id: new_fc_tag_excerpt
                multiline: True
                text: root.data['fc_tag_excerpt'] if 'fc_tag_excerpt' in root.data else ""
                on_text: root.data['fc_tag_excerpt'] = self.text
            RstDocument:
                text: new_fc_tag_excerpt.text
                show_errors: True
        BoxLayout:
            size_hint_y: 0.2
            Button:
                text: "Cancel"
                on_release: lib.Navigation.page_nav(dest='prev_page', orig='new_flash_card_tag', edit=False)
            Button:
                text: "Submit"
                on_release: root.dispatch('on_submit', root.data)

<FlashCardDeckCardRow@BoxLayout>:
    fc_id: ''
    fc_title: ''
    fc_deck_id: ''
    canvas.before:
        Color:
            rgba: 0.5, 0.5, 0.5, 1
        Rectangle:
            size: self.size
            pos: self.pos
    BoxLayout:
        Label:
            text: root.fc_title
        Button:
            size_hint_x: 0.2
            text_size: self.size
            halign: 'center'
            valign: 'middle'
            text: "Remove\nfrom Deck"
            on_release: lib.Queries.remove_fc_from_deck(root.fc_id)
        Button:
            size_hint_x: 0.2
            text: "View/Edit"
            on_release: lib.Navigation.page_nav(dest='new_flash_card', orig='flash_card_deck', edit=True, fc_id=root.fc_id)
        Button:
            size_hint_x: 0.1
            text: "D\nE\nL"
            on_release: lib.Navigation.confirm_flash_card_delete(root.fc_id)

<FlashCardDeckScreen>:
    fc_rv: fc_rv
    BoxLayout:
        orientation: "vertical"
        TopMenu:
        BoxLayout:
            BoxLayout:
                orientation: "vertical"
                RecycleView:
                    id: fc_rv
                    scroll_type: ['bars', 'content']
                    scroll_wheel_distance: dp(114)
                    bar_width: dp(10)
                    viewclass: 'FlashCardDeckCardRow'
                    RecycleBoxLayout:
                        padding: [dp(10), 0, dp(10), 0]
                        default_size: None, dp(50)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: 'vertical'
                        spacing: dp(2)
            BoxLayout:
                padding: [0, 0, dp(10), dp(10)]
                orientation: "vertical"
                RstDocument:
                    text: root.data['fc_deck_excerpt'] if 'fc_deck_excerpt' in root.data else ""
                BoxLayout:
                    size_hint_y: 0.1
                    Button:
                        text: "Edit Deck"
                        on_release: lib.Navigation.page_nav(dest='new_flash_card_deck', orig='flash_card_deck', edit=True)
                    Button:
                        text: "Delete Deck"
                        on_release: lib.Navigation.confirm_flash_card_deck_delete(root.fc_deck_id)
                    Button:
                        text: "Study Deck"
                        on_release: lib.Navigation.page_nav(dest='flash_card_deck_study', orig='flash_card_deck', fc_deck_id=root.fc_deck_id)



<NewFlashCardDeckScreen>:
    title: "New/Edit Flash Card Deck"
    BoxLayout:
        orientation: "vertical"
        BoxLayout:
            size_hint_y: 0.1
            padding: dp(10)
            orientation: "vertical"
            BoxLayout:
                Label:
                    size_hint_x: 0.3
                    text: "Deck Name"
                TextInput:
                    text: root.data['fc_deck_name'] if 'fc_deck_name' in root.data else ""
                    padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
#                    id: new_author_first
                    on_text: root.data['fc_deck_name'] = self.text
        BoxLayout:
            orientation: "vertical"
            BoxLayout:
                TextInput:
                    id: text_input_1
                    multiline: True
                    text: root.data['fc_deck_excerpt'] if 'fc_deck_excerpt' in root.data else ""
                    on_text: root.data['fc_deck_excerpt'] = self.text
                RstDocument:
#                    id: rstdocument
                    text: text_input_1.text
                    show_errors: True
        BoxLayout:
            size_hint_y: 0.2
            Button:
                text: "Cancel"
                on_release: lib.Navigation.page_nav(dest='prev_page', orig='new_flash_card_deck', edit=False)
            Button:
                text: "Submit"
                on_release: root.dispatch('on_submit', root.data)

<DeleteFlashCardDeckConfirmationPopup>:
    fc_deck_id: ''
    fc_deck_name: ''
    title: root.fc_deck_name
    BoxLayout:
        Button:
            text: "Yes, delete this deck."
            on_release: root.on_confirm()
        Button:
            text: "No, don't delete this deck."
            on_release: root.on_close()

<DeleteFlashCardConfirmationPopup>:
    fc_id: ''
    fc_title: ''
    title: root.fc_title
    BoxLayout:
        Button:
            text: "Yes, delete this card."
            on_release: root.on_confirm()
        Button:
            text: "No, don't delete this card."
            on_release: root.on_close()

<FlashCardDeckStudyScreenBtn@Button>:
    text_size: self.size
    halign: 'center'
    valign: 'middle'

<FlashCardDeckStudyScreen>:
    BoxLayout:
        orientation: "vertical"
        TopMenu:
        BoxLayout:
            orientation: "vertical"
            Label:
                id: fc_side
                size_hint_y: 0.1
                text: root.data['fc_side'] if 'fc_side' in root.data else ""
            BoxLayout:
                RstDocument:
                    canvas:
                        Rectangle:
                            source: root.data['fc_visible_image'] if 'fc_visible_image' in root.data else ""
                            size: self.size
                            pos: self.pos
                    id: fc_visible
                    text: root.data['fc_visible_text'] if 'fc_visible_text' in root.data else ""
                Button:
                    size_hint_x: None
                    width: dp(100)
                    text: "Flip"
                    on_release: root.on_flip_card()
            BoxLayout:
                size_hint_y: None
                height: dp(50)
                FlashCardDeckStudyScreenBtn:
                    text: "Very Easy\n" + root.data['very_easy'] + " Day(s)" if 'very_easy' in root.data else "Very Easy"
                    on_release: root.on_complete(1)
                FlashCardDeckStudyScreenBtn:
                    text: "Easy\n" + root.data['easy'] + " Day(s)" if 'easy' in root.data else "Easy"
                    on_release: root.on_complete(2)
                FlashCardDeckStudyScreenBtn:
                    text: "Normal\n" + root.data['normal'] + " Day(s)" if 'normal' in root.data else "Normal"
                    on_release: root.on_complete(3)
                FlashCardDeckStudyScreenBtn:
                    text: "Hard\n" + root.data['hard'] + " Day(s)" if 'hard' in root.data else "Hard"
                    on_release: root.on_complete(4)
                FlashCardDeckStudyScreenBtn:
                    text: "Very Hard\n" + root.data['very_hard'] + " Day(s)" if 'very_hard' in root.data else "Very Hard"
                    on_release: root.on_complete(5)
                FlashCardDeckStudyScreenBtn:
                    text: "Study Again\nToday"
                    on_release: root.on_complete(10)


<ColorBar@BoxLayout>:
    size_hint_y: None
    height: dp(50)
    ToggleButton:
        group: 'line_width'
        text: "Thin"
        on_release: playground.DrawSpace.set_line_width(line_width=1)
    ToggleButton:
        group: 'line_width'
        text: "Normal"
        on_release: playground.DrawSpace.set_line_width(line_width=1.5)
    ToggleButton:
        group: 'line_width'
        text: "Thick"
        on_release: playground.DrawSpace.set_line_width(line_width=2.25)
    ToggleButton:
        group: 'line_width'
        text: "Very Thick"
        on_release: playground.DrawSpace.set_line_width(line_width=3)
    ToggleButton:
        group: 'color'
        state: 'down'
        on_release: playground.DrawSpace.set_color(rgba=[0,0,0,1])
        canvas:
            Color:
                rgba: 0, 0, 0, 1
            Rectangle:
                size: (self.width, self.height/2)
                pos: self.pos
    ToggleButton:
        group: 'color'
        on_release: playground.DrawSpace.set_color(rgba=[1,0,0,1])
        canvas:
            Color:
                rgba: 1, 0, 0, 1
            Rectangle:
                size: (self.width, self.height/2)
                pos: self.pos
    ToggleButton:
        group: 'color'
        on_release: playground.DrawSpace.set_color(rgba=[0,1,0,1])
        canvas:
            Color:
                rgba: 0, 1, 0, 1
            Rectangle:
                size: (self.width, self.height/2)
                pos: self.pos
    ToggleButton:
        group: 'color'
        on_release: playground.DrawSpace.set_color(rgba=[0,0,1,1])
        canvas:
            Color:
                rgba: 0, 0, 1, 1
            Rectangle:
                size: (self.width, self.height/2)
                pos: self.pos